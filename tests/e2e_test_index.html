const { Builder, By, Key, until } = require('selenium-webdriver');
const assert = require('assert');

describe('Simon Game End-to-End Tests', function() {
    let driver;

    // Setup: Initialize the WebDriver before each test
    before(async function() {
        driver = await new Builder().forBrowser('chrome').build();
        await driver.get('file://path/to/your/index.html'); // Update with the correct path to your index.html
    });

    // Teardown: Quit the WebDriver after each test
    after(async function() {
        await driver.quit();
    });

    it('should display the title and instructions on load', async function() {
        const title = await driver.findElement(By.id('level-title')).getText();
        assert.strictEqual(title, 'Press A Key to Start');
    });

    it('should start the game when a key is pressed', async function() {
        await driver.actions().sendKeys(Key.SPACE).perform(); // Simulate key press
        const title = await driver.findElement(By.id('level-title')).getText();
        assert.notStrictEqual(title, 'Press A Key to Start'); // Title should change
    });

    it('should play sound and animate button when clicked', async function() {
        const button = await driver.findElement(By.id('green'));
        await button.click();

        // Check if the button has the 'pressed' class
        const isPressed = await button.getAttribute('class').then(classes => classes.includes('pressed'));
        assert.strictEqual(isPressed, true);

        // Wait for a short duration to allow animation to complete
        await driver.sleep(200);
    });

    it('should correctly check the user answer', async function() {
        await driver.actions().sendKeys(Key.SPACE).perform(); // Start the game
        const button = await driver.findElement(By.id('red'));
        await button.click(); // User clicks a button

        // Check if the game responds correctly (e.g., title changes)
        const title = await driver.findElement(By.id('level-title')).getText();
        assert.notStrictEqual(title, 'Game Over, Press Any Key to Restart!'); // Should not be game over yet
    });

    it('should end the game on incorrect answer', async function() {
        await driver.actions().sendKeys(Key.SPACE).perform(); // Start the game
        const button = await driver.findElement(By.id('green'));
        await button.click(); // Correct button click

        // Simulate incorrect button click
        const wrongButton = await driver.findElement(By.id('blue'));
        await wrongButton.click();

        // Check if the game displays the game over message
        const title = await driver.findElement(By.id('level-title')).getText();
        assert.strictEqual(title, 'Game Over, Press Any Key to Restart!');
    });

    it('should restart the game when a key is pressed after game over', async function() {
        await driver.actions().sendKeys(Key.SPACE).perform(); // Start the game
        const title = await driver.findElement(By.id('level-title')).getText();
        assert.notStrictEqual(title, 'Game Over, Press Any Key to Restart!'); // Should not be game over

        // Simulate game over
        const button = await driver.findElement(By.id('green'));
        await button.click(); // Correct button click
        const wrongButton = await driver.findElement(By.id('blue'));
        await wrongButton.click(); // Incorrect button click

        // Check game over message
        const gameOverTitle = await driver.findElement(By.id('level-title')).getText();
        assert.strictEqual(gameOverTitle, 'Game Over, Press Any Key to Restart!');

        // Restart the game
        await driver.actions().sendKeys(Key.SPACE).perform();
        const newTitle = await driver.findElement(By.id('level-title')).getText();
        assert.notStrictEqual(newTitle, 'Game Over, Press Any Key to Restart!'); // Should start a new game
    });
});